b4w.register("PirateIsland_main",function(D,b){function E(d,a){a?(y.create_preloader(),d.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},document.getElementById("main_canvas_container").children[1].style.backgroundImage="url('villatuerto_bg.png')",F.load(G+"PirateIsland.json",H,I)):console.log("b4w init failure")}function I(d){y.update_preloader(d)}function H(d,a){if(a){m=e.get_first_character();r=e.get_active_camera();n=e.get_object_by_name("CubeThrower");z=e.get_object_by_name("Tomato");
t.set("max_fps",45);t.set("max_fps_physics",500);J();A.correct_up(r);var c=g.create_keyboard_sensor(g.KEY_I);g.create_sensor_manifold(m,"TAKE_SCREENSHOT",g.CT_SHOT,[c],null,K);L.get_canvas().addEventListener("mousedown",M,!1);u.enable_fps_controls();u.set_cam_smooth_factor(.01);u.set_cam_sensitivity(110);N.set_day_time(4)}else console.log("b4w load failure")}function K(){O.shot();console.log("Picture taken.")}function M(){var d=v.copy(z,"Tomato."+String(++P),!1);e.append_object(d);A.get_camera_angles(r,
w);console.log("Camera angles: "+w);var a=h.get_translation(n,l),c=h.get_rotation(n,p);k.set_transform(d,l,p);h.set_rotation_v(d,p);h.rotate_x_local(d,-w[1]);k.apply_velocity(d,0,-50,0);Q(d);console.log("Thrower position: "+a[0]+", "+a[1]+", "+a[2]);console.log("Thrower rotation: "+c[0]+", "+c[1]+", "+c[2]+", "+c[3]);a=h.get_translation(m,l);console.log("Character position: "+a[0]+", "+a[1]+", "+a[2]);console.log("Click made")}function Q(d){if(k.has_physics(d)){k.enable_simulation(d);var a=g.create_collision_sensor(d,
"ANY",!0);g.create_sensor_manifold(d,"COLLISION",g.CT_CONTINUOUS,[a],function(){return!0},R)}}function R(d,a,c){if(1==c&&g.get_sensor_value(d,a,0)){c=q.create();q.create();var b=x.create(),f=g.get_sensor_payload(d,a,0);if(null!=f.coll_obj){a=e.get_object_by_name("TomatoSplash");a=v.copy(a,"TomatoSplash. "+String(++S),!1);e.append_object(a);q.set_trans(f.coll_pos,c);x.rotationTo(T.AXIS_Z,f.coll_norm,b);h.set_rotation_v(a,b);q.set_quat(b,c);if("BODRIO"==f.coll_obj.collision_id){b=[f.coll_obj,a];if(Array.isArray(b))for(f=
0;f<b.length;f++)B(b[f],100);else B(b,100);console.log("Bodrio killed")}h.set_tsr(a,c);e.remove_object(d)}else null==f.coll_obj&&console.log("Tomato collided "+f)}}function B(b,a){var c=a,d=setInterval(function(){0==a?(e.remove_object(b),clearInterval(d)):(a--,U.set_alpha_factor(b,b.materials[0].name,a/c))},1)}function J(){var b=e.get_all_objects("EMPTY"),a=0;setInterval(function(){if(2<a)a=0;else{var c=e.get_object_by_name("Bodrio"),c=v.copy(c,"Bodrio."+a.toString(),!0);e.append_object(c);k.enable_simulation(c);
h.get_translation(b[a],l);h.set_translation_v(c,l);k.set_transform(c,l,p);k.sync_transform(c);V.push(c);a++}},5E3);W.append_stiff_trans_rot(n,m,[-1,0,1.2])}var X=b("app"),t=b("config"),F=b("data"),y=b("preloader"),Y=b("version"),u=b("fps"),N=b("lights"),g=b("controls"),e=b("scenes"),O=b("screenshooter"),L=b("container"),W=b("constraints"),h=b("transform"),Z=b("vec3"),v=b("objects"),k=b("physics"),x=b("quat"),A=b("camera"),T=b("util"),q=b("tsr"),U=b("material"),w=new Float32Array(2),l=Z.create(),p=
x.create(),m,r,n,z,P=0,S=0,V=[],C="DEBUG"==Y.type(),G=t.get_assets_path("PirateIsland");D.init=function(){X.init({canvas_container_id:"main_canvas_container",callback:E,show_fps:C,console_verbose:C,autoresize:!0})}});b4w.require("PirateIsland_main").init();
