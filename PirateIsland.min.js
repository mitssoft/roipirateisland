b4w.register("PirateIsland_main",function(I,b){function J(c,a){a?(C.create_preloader(),c.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},document.getElementById("main_canvas_container").children[1].style.backgroundImage="url('villatuerto_bg.png')",K.load(L+"PirateIsland.json",M,N)):console.log("b4w init failure")}function N(c){C.update_preloader(c)}function M(c,a){if(a){q=d.get_first_character();v=d.get_active_camera();r=d.get_object_by_name("CubeThrower");D=d.get_object_by_name("Tomato");
w.set("max_fps",45);w.set("max_fps_physics",500);O();E.correct_up(v,x.AXIS_Z,!0);P.append_stiff_trans_rot(r,q,[-1,0,1.2]);var b=g.create_keyboard_sensor(g.KEY_I);g.create_sensor_manifold(q,"TAKE_SCREENSHOT",g.CT_SHOT,[b],null,Q);R.get_canvas().addEventListener("mousedown",S,!1);y.enable_fps_controls();y.set_cam_smooth_factor(.01);y.set_cam_sensitivity(110);T.set_day_time(4)}else console.log("b4w load failure")}function Q(){U.shot();console.log("Picture taken.")}function S(){var c=p.copy(D,"Tomato."+
String(++V),!0);d.append_object(c);E.get_camera_angles(v,z);console.log("Camera angles: "+z);e.get_translation(r,l);var a=e.get_rotation(r,m);console.log("Thrower rotation: "+a[0]+", "+a[1]+", "+a[2]+", "+a[3]);h.set_transform(c,l,m);e.set_rotation_v(c,m);e.get_rotation(c,m);console.log("Tomato original rotation: "+a[0]+", "+a[1]+", "+a[2]+", "+a[3]);e.rotate_x_local(c,-z[1]);e.get_rotation(c,m);console.log("Tomato corrected to camera rotation: "+a[0]+", "+a[1]+", "+a[2]+", "+a[3]);h.apply_velocity(c,
0,-50,0);W(c);(A=d.get_object_by_name("TomatoThrowSpeaker"))&&p.is_speaker(A)&&X.play_def(A);e.get_translation(q,l);console.log("Click made")}function W(c){if(h.has_physics(c)){h.enable_simulation(c);var a=g.create_collision_sensor(c,"ANY",!0);g.create_sensor_manifold(c,"COLLISION",g.CT_CONTINUOUS,[a],function(){return!0},Y)}}function Y(c,a,b){if(1==b&&g.get_sensor_value(c,a,0)){b=n.create();n.create();var k=t.create(),f=g.get_sensor_payload(c,a,0);null!=f.coll_obj&&"Tomato"!=f.coll_obj.name?(a=d.get_object_by_name("TomatoSplash"),
a=p.copy(a,"TomatoSplash. "+String(++F),!0),d.append_object(a),n.set_trans(f.coll_pos,b),t.rotationTo(x.AXIS_Z,f.coll_norm,k),e.set_rotation_v(a,k),n.set_quat(k,b),console.log("Tomato collided: "+f.coll_obj.name),"BODRIO"==f.coll_obj.collision_id&&(Z([f.coll_obj,a]),u.splice(u.findIndex(function(a){return a==f.coll_obj.name},1)),console.log("Bodrio killed")),e.set_tsr(a,b),d.remove_object(c)):null==f.coll_obj&&(Math.random()>1/3?(a=d.get_object_by_name("TomatoSplash"),a=p.copy(a,"TomatoSplash. "+
String(++F),!0),d.append_object(a),n.set_trans(f.coll_pos,b),t.rotationTo(x.AXIS_Z,f.coll_norm,k),e.set_rotation_v(a,k),n.set_quat(k,b),d.remove_object(c),e.set_tsr(a,b),console.log("Tomato collided "+f),aa(a,5E3)):g.remove_sensor_manifold(c,"COLLISION"))}}function Z(c){if(Array.isArray(c))for(var a=0;a<c.length;a++)B(c[a],100);else B(c,100)}function B(c,a){var b=a,e=setInterval(function(){if(0==a)return d.remove_object(c),clearInterval(e),!0;a--;ba.set_alpha_factor(c,c.materials[0].name,a/b)},1)}
function aa(c,a){setTimeout(function(){1==B(c,100)&&d.remove_object(c)},a)}function O(){var c=d.get_all_objects("EMPTY"),a=0;setInterval(function(){if(2<a)a=0;else if(u.length<c.length){var b=d.get_object_by_name("Bodrio"),b=p.copy(b,"Bodrio."+a.toString(),!0);d.append_object(b);h.enable_simulation(b);e.get_translation(c[a],l);e.set_translation_v(b,l);h.set_transform(b,l,m);h.sync_transform(b);u.push(b);a++}},5E3)}var ca=b("app"),w=b("config"),K=b("data"),C=b("preloader"),da=b("version"),y=b("fps"),
T=b("lights"),g=b("controls"),d=b("scenes"),U=b("screenshooter"),R=b("container"),P=b("constraints"),e=b("transform"),G=b("vec3"),p=b("objects"),h=b("physics"),t=b("quat"),E=b("camera"),x=b("util"),n=b("tsr"),ba=b("material"),X=b("sfx"),z=new Float32Array(2),l=G.create();G.create();var m=t.create(),q,v,r,D,V=0,F=0,A,u=[],H="DEBUG"==da.type(),L=w.get_assets_path("PirateIsland");I.init=function(){ca.init({canvas_container_id:"main_canvas_container",callback:J,show_fps:H,console_verbose:H,autoresize:!0})}});
b4w.require("PirateIsland_main").init();
